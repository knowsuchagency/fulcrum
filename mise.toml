[tools]
bun = "latest"

[hooks.postinstall]
run = "bun install"

[tasks.dev]
description = "Start frontend and backend dev servers"
usage = 'arg "[port]" help="Port to run on" default="3333"'
run = """
export PORT="${usage_port}"
export VITE_BACKEND_PORT="${usage_port}"
bunx concurrently -n server,client -c blue,green 'mise run server' 'mise run client'
"""

[tasks.server]
description = "Start backend dev server with auto-reload"
run = """
mkdir -p ~/.vibora
bun run drizzle-kit push
bun --watch server/index.ts
"""

[tasks.client]
description = "Start frontend dev server"
run = "vite --host"

[tasks.build]
description = "Build for production"
run = "bunx tsc -b && bunx vite build"

[tasks.start]
description = "Run production server"
depends = ["build"]
run = "NODE_ENV=production bun server/index.ts"

[tasks.lint]
description = "Run ESLint"
run = "bunx eslint ."

[tasks.typecheck]
description = "Check TypeScript types"
run = "bunx tsc --noEmit"

[tasks.check]
description = "Run all checks (lint + typecheck)"
depends = ["lint", "typecheck"]

[tasks.preview]
description = "Preview production build"
run = "vite preview"

[tasks."db:push"]
description = "Sync schema to database"
run = "bun run drizzle-kit push"

[tasks."db:studio"]
description = "Open Drizzle Studio GUI"
run = "bun run drizzle-kit studio"

[tasks."db:generate"]
description = "Generate migrations"
run = "bun run drizzle-kit generate"

[tasks."db:migrate"]
description = "Apply migrations"
run = "bun run drizzle-kit migrate"

# CLI tasks
[tasks."cli"]
description = "Run CLI command"
usage = 'arg "[args]..." help="Arguments to pass to CLI" default=""'
run = "bun cli/src/index.ts ${usage_args}"

[tasks."cli:link"]
description = "Link CLI for global access"
dir = "cli"
run = "bun link"

[tasks."cli:typecheck"]
description = "Typecheck CLI"
run = "bunx tsc --noEmit -p cli/tsconfig.json"
