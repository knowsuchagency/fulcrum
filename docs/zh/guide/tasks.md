# 任务与工作树

任务是 Vibora 的核心工作单元。每个任务代表在隔离的 git 工作树中进行的一项工作。

## 任务工作原理

当您创建任务时：

1. **创建新的 git 工作树** — 从仓库的主分支创建
2. **打开终端** — 在工作树目录中
3. **任务出现在看板上** — 在"进行中"列
4. **状态自动同步** — 使用 Claude Code 插件时

## 任务状态

| 状态 | 描述 |
|--------|-------------|
| **进行中** | 正在进行工作 |
| **待审核** | 等待审核或批准 |
| **已完成** | 工作已完成 |
| **已取消** | 任务已放弃 |

安装 Claude Code 插件后，状态会自动变化：
- Claude 停止等待输入时 → **待审核**
- 您回复 Claude 时 → **进行中**

## 创建任务

### 从导航栏

点击顶部导航栏的 **+** 按钮打开创建任务对话框。选择仓库，输入任务名称，可选择关联 Linear 工单。

### 从仓库视图

1. 进入 **仓库**
2. 点击仓库上的 **新建任务**
3. 输入任务名称
4. 可选择关联 Linear 工单

## 管理任务

### 看板

看板按状态显示所有任务。在列之间拖动任务，或使用任务菜单执行操作。

### 任务终端视图

在一个并行视图中查看所有任务的 Claude Code 会话。这是编排多个代理的核心功能。

### 任务详情视图

点击任务打开分屏布局的详情视图：

![任务详情视图](/screenshots/task-detail-split-view.png)

左侧面板显示 Claude Code 终端。右侧面板有三个标签页：

- **差异** — 查看工作树与基础分支的所有变更
- **浏览器** — 集成浏览器，在 Claude 工作时预览应用
- **文件** — 浏览和编辑工作树中的文件

标题栏包含常用 git 操作的快捷按钮：

![任务详情 Git 按钮](/screenshots/task-detail-git-buttons.png)

| 按钮 | 操作 |
|--------|--------|
| **→\|** | **从主分支拉取** — 将工作树变基到最新基础分支 |
| **\|←** | **合并到主分支** — 将工作树压缩合并到基础分支并标记任务完成 |
| **↑** | **推送到远程** — 将工作树分支推送到远程 |
| **⟳** | **同步父仓库** — 从远程拉取最新更改到父仓库的基础分支 |
| **⑂** | **提交** — 向 Claude Code 发送提交提示 |
| **⎇** | **创建 PR** — 从工作树分支创建拉取请求 |
| **🗑** | **删除** — 删除任务，可选删除工作树 |

下图显示这些操作之间的关系：

![Git 工作流](/screenshots/task-detail-git-workflow.png)

如果 git 操作失败，您会看到一个带有"使用 Claude 解决"按钮的提示，该按钮会向 Claude Code 发送详细提示以帮助修复问题。

## Git 工作树

每个任务运行在独立的 [git 工作树](https://git-scm.com/docs/git-worktree) 中。这提供了：

- **隔离性** — 一个任务的更改不影响其他任务
- **干净的主分支** — 主分支保持不变
- **易于清理** — 删除任务时工作树一并删除
- **并行工作** — 同时开发多个功能

### 工作树位置

工作树默认创建在 `~/.vibora/worktrees/`（或 `$VIBORA_DIR/worktrees/`）。

## 关联 Linear

创建任务时可关联 Linear 工单，也可稍后通过任务设置添加。当 Vibora 中的任务状态改变时，关联的 Linear 工单会自动更新。

## 关联拉取请求

使用任务详情视图中的 **创建 PR** 按钮，或通过任务设置关联现有 PR。PR 会显示在任务卡片和 PR 审核视图中。
